<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Services - FREENT</title>
  <link rel="icon" type="image/jpg" href="../assets/lineslogo.jpg" />
  <link rel="stylesheet" href="../css-files/index.css" />
  <link rel="stylesheet" href="../css-files/services.css" /> 
  <link rel="stylesheet" href="../css-files/shirt-designer.css" />
  <link rel="stylesheet" href="../css-files/modals.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/5.3.0/fabric.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.6.0/mammoth.browser.min.js"></script>
 
 <!-- All styles moved to services.css -->
</head>
<body>
  <div id="main-content">
    <header class="site-header">
      <div class="header-top">
        <div class="logo">
          <img src="../assets/lineslogo.jpg" alt="Lines Printing Services Logo" />
        </div>
      </div>

      <nav class="nav-wrapper">
        <ul class="main-nav">
          <li><a href="../index.html">HOME</a></li> 
          <li class="services-dropdown">
            <a href="#">SERVICES ‚ñ∏</a>
            <ul class="dropdown-menu">
              <li><a href="#" onclick="openModal('document')"><i class="fas fa-file-alt"></i> Document Printing</a></li>
              <li><a href="#" onclick="openModal('photo')"><i class="fas fa-image"></i> Photo Printing</a></li>
              <li><a href="#" onclick="openShirtDesignerChoice()"><i class="fas fa-tshirt"></i> Shirt Printing</a></li>
              <li><a href="#" onclick="openModal('tarpaulin')"><i class="fas fa-rectangle-ad"></i> Tarpaulin Printing</a></li>
              <li><a href="#"><i class="fas fa-sign"></i> Signages</a></li>
              <li><a href="#" onclick="openModal('stickers')"><i class="fas fa-sticky-note"></i> Stickers</a></li>
              <li><a href="#"><i class="fas fa-gift"></i> Gift Boxes</a></li>
              <li><a href="#"><i class="fas fa-id-badge"></i> Lanyards</a></li>
              <li><a href="#"><i class="fas fa-envelope"></i> Invitations</a></li>
              <li><a href="#" onclick="openModal('customized')"><i class="fas fa-magic"></i> Customized</a></li>
            </ul>
          </li>
          <!-- ORDERS link - only shown when logged in -->
          <li id="ordersNavItem" style="display: none;">
            <a href="../user.html">ORDERS</a>
          </li>
          <li class="search-wrapper">
            <form class="search-form" onsubmit="handleSearch(event)">
              <div class="search-input-wrapper">
                <i class="fa fa-search search-icon"></i>
                <input type="text" id="search-input" placeholder="Search services..." oninput="showSearchSuggestions(event)" />
              </div>
              
            </form>
            <div id="searchSuggestions" class="search-suggestions"></div>
          </li>
        </ul>
      </nav>
      <div class="header-actions">
        <!-- Notification Bell -->
        <div id="notificationBell" class="notification-bell" style="display: none;">
          <button class="notification-btn" onclick="toggleNotificationDropdown()">
            <i class="fas fa-bell"></i>
            <span id="notificationBadge" class="notification-badge" style="display: none;">0</span>
          </button>
          <div id="notificationDropdown" class="notification-dropdown">
            <div class="notification-dropdown-header">
              <h4><i class="fas fa-bell"></i> Notifications</h4>
              <button class="mark-all-read-btn" onclick="markAllNotificationsRead()">
                <i class="fas fa-check-double"></i> Mark all read
              </button>
            </div>
            <div id="notificationDropdownList" class="notification-dropdown-list">
              <div class="notification-loading">
                <i class="fas fa-spinner fa-spin"></i> Loading...
              </div>
            </div>
            <div class="notification-dropdown-footer">
              <a href="../user.html" class="view-all-link">
                <i class="fas fa-list"></i> View All Notifications
              </a>
            </div>
          </div>
        </div>
        
        <!-- User indicator - shown when logged in -->
        <div id="userIndicator" class="user-indicator" style="display: none;">
          <i class="fas fa-user-circle"></i>
          <span id="usernameDisplay">User</span>
        </div>
        <!-- Login button - shown when not logged in -->
        <button id="loginBtn" class="cta login-btn" onclick="window.location.href='./login.html'" style="display: block;">
          Login
        </button>
        <!-- Account button - shown when logged in -->
        <button id="accountBtn" class="account-btn" onclick="window.location.href='../dashboard.html'" style="display: none;">
          <i class="fas fa-user-circle"></i>
          Account
        </button>
      </div>
    </header>
  </div>

  <section class="hero">
    <div class="hero-content">
      <h1 class="hero-title">Our Services</h1>
      <p class="hero-subtext">Explore our wide range of printing and customization services.</p>
      <button class="get-started" onclick="scrollToServices()">View Services</button>
    </div>
  </section>

  <div class="advantages">
    <div class="advantage-item">
      <img src="../assets/cartIcon.png" alt="Convenient" />
      <p>Convenient</p>
    </div>
    <div class="advantage-item">
      <img src="../assets/starIcon.png" alt="Quality" />
      <p>Quality</p>
    </div>
    <div class="advantage-item">
      <img src="../assets/clockIcon.png" alt="Fast Service" />
      <p>Fast Service</p>
    </div>
  </div>

  <section id="services-cards" class="services-section">
    <h2>Printing Options</h2>
    <div class="services-grid">
      
      <div class="service-card available" onclick="openModal('document')">
        <i class="fas fa-file-alt"></i>
        <h3>Document Printing</h3>
        <p>Print your documents in various sizes</p>
        <span class="available-badge">Available Now</span>
      </div>

      <div class="service-card available" onclick="openModal('photo')">
        <i class="fas fa-image"></i>
        <h3>Photo Printing</h3>
        <p>High-quality photo prints</p>
        <span class="available-badge">Available Now</span>
      </div>

      <div class="service-card available" onclick="openShirtDesignerChoice()">
        <i class="fas fa-tshirt"></i>
        <h3>Shirt Printing</h3>
        <p>2D & 3D Designers Available</p>
        <span class="available-badge">Available Now</span>
      </div>

      <div class="service-card available" onclick="openModal('tarpaulin')">
        <i class="fas fa-rectangle-ad"></i>
        <h3>Tarpaulin Printing</h3>
        <p>Large format prints</p>
        <span class="available-badge">Available Now</span>
      </div>

      <div class="service-card available" onclick="openModal('stickers')">
        <i class="fas fa-sticky-note"></i>
        <h3>Stickers</h3>
        <p>Waterproof custom stickers</p>
        <span class="available-badge">Available Now</span>
      </div>

      <div class="service-card available" onclick="openModal('customized')">
        <i class="fas fa-gift"></i>
        <h3>Customized Items</h3>
        <p>Design Your Own</p>
        <span class="available-badge">Available Now</span>
      </div>
    </div>
  </section>

  <section id="samples-section" class="samples">
    <h2>More Offers from Lines Hub</h2>
    <div class="sample-gallery">
      <div class="sample-item"><img src="../assets/custom1.jpg" alt="Sample 1" /></div>
      <div class="sample-item"><img src="../assets/custom2.jpg" alt="Sample 2" /></div>
      <div class="sample-item"><img src="../assets/custom3v4.jpg" alt="Sample 3" /></div>
      <div class="sample-item"><img src="../assets/custom4.jpg" alt="Sample 4" /></div>
      <div class="sample-item"><img src="../assets/custom5.jpg" alt="Sample 5" /></div>
      <div class="sample-item"><img src="../assets/custom6.jpg" alt="Sample 6" /></div>
    </div>

    <div class="view-services-wrapper">
      <button class="view-services">Contact Us &raquo;</button>
    </div>
  </section>

  <!-- SHIRT DESIGNER CHOICE MODAL -->
  <div class="modal-overlay" id="shirtChoiceModal" onclick="closeChoiceModalOnOverlay(event)">
    <div class="modal" onclick="event.stopPropagation()" style="max-width: 700px;">
      <div class="modal-header">
        <h2><i class="fas fa-tshirt"></i> Choose Your Design Method</h2>
        <button class="close-btn" onclick="closeChoiceModal()">&times;</button>
      </div>

      <div class="form-group">
        <label style="text-align: center; display: block; margin-bottom: 1.5rem; font-size: 1.1rem;">
          Select how you'd like to design your t-shirt
        </label>
        
        <div class="designer-choice-buttons">
          <button class="designer-choice-btn" onclick="open3DDesigner()">
            <i class="fas fa-cube"></i>
            <strong>3D Designer</strong>
            <small>Interactive 3D design tool with live preview</small>
          </button>
          
          <button class="designer-choice-btn" onclick="openQuickDesigner()">
            <i class="fas fa-pencil-alt"></i>
            <strong>Quick Upload</strong>
            <small>Got a design? Upload it for us to customize</small>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- 3D DESIGNER MODAL -->
  <div class="designer-modal-overlay" id="designer3DModal">
    <div class="designer-modal-content">
      <div class="designer-modal-header">
        <h2><i class="fas fa-cube"></i> 3D T-Shirt Designer</h2>
        <button class="designer-close-btn" onclick="close3DDesigner()">
          <i class="fas fa-times"></i> Close Designer
        </button>
      </div>
      <iframe 
        id="designerIframe"
        class="designer-iframe"
        src="about:blank"
        title="3D T-Shirt Designer"
      ></iframe>
    </div>
  </div>

  <!-- REGULAR SERVICES MODAL -->
  <div class="modal-overlay" id="modalOverlay" onclick="closeModalOnOverlay(event)">
    <div class="modal" id="orderModal" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2><i class="fas fa-file-alt"></i> <span id="modalTitle">Service Order</span></h2>
        <button class="close-btn" onclick="closeModal()">&times;</button>
      </div>

      <form id="orderForm" onsubmit="handleSubmit(event)">
        <!-- Dynamic Form Container -->
        <div id="dynamicFormContainer"></div>

        <!-- Payment Method (common to all services) -->
        <div class="form-group">
          <label>Payment Method</label>
          <div class="payment-options">
            <div class="payment-option" id="payment-cash" onclick="selectPayment('cash', this)">
              <i class="fas fa-money-bill-wave"></i>
              <p>Cash</p>
            </div>
            <div class="payment-option" id="payment-gcash" onclick="selectPayment('gcash', this)">
              <i class="fas fa-mobile-alt"></i>
              <p>GCash</p>
            </div>
            <div class="payment-option" id="payment-card" onclick="selectPayment('card', this)">
              <i class="fas fa-credit-card"></i>
              <p>Card</p>
              <small class="payment-min-notice" style="display: none; color: #ff6b6b; font-size: 0.75rem; margin-top: 0.25rem;">Min ‚Ç±999</small>
            </div>
            <div class="payment-option" id="payment-bank" onclick="selectPayment('bank', this)">
              <i class="fas fa-university"></i>
              <p>Bank Transfer</p>
              <small class="payment-min-notice" style="display: none; color: #ff6b6b; font-size: 0.75rem; margin-top: 0.25rem;">Min ‚Ç±999</small>
            </div>
          </div>
          <input type="hidden" id="paymentMethod" required />
        </div>

        <!-- Price Display -->
        <div class="price-display">
          <div class="label">Total Amount</div>
          <div class="amount" id="totalPrice">‚Ç±0.00</div>
        </div>

        <!-- Submit Button -->
        <button type="submit" class="submit-btn" id="submitBtn" disabled>Place Order</button>
      </form>
    </div>
    
    <!-- PDF VIEWER PANEL -->
    <div class="pdf-viewer-panel" id="pdfViewerPanel" onclick="event.stopPropagation()">
      <div class="pdf-viewer-header">
        <h3><i class="fas fa-file-pdf"></i> Document Preview</h3>
        <button class="close-viewer-btn" onclick="closePdfViewer()">&times;</button>
      </div>
      <div class="pdf-viewer-content">
        <div class="pdf-page-info">
          <span id="currentPageNum">1</span> / <span id="totalPagesNum">1</span>
        </div>
        <div class="pdf-canvas-container">
          <canvas id="pdfCanvas"></canvas>
        </div>
        <div class="pdf-viewer-controls">
          <button class="pdf-nav-btn" id="prevPageBtn" onclick="previousPage()" disabled>
            <i class="fas fa-chevron-left"></i> Previous
          </button>
          <button class="pdf-nav-btn" id="nextPageBtn" onclick="nextPage()" disabled>
            Next <i class="fas fa-chevron-right"></i>
          </button>
        </div>
      </div>
    </div>
  </div>

  <footer class="site-footer"></footer>
    <div class="footer-content">
      <div class="footer-brand">
        <img src="../assets/lineslogo.jpg" alt="Lines Printing Services Logo" />
        <p>Lines Printing Services<br />Your Freedom to Print</p>
      </div>

      <div class="footer-links">
        <a href="../index.html">Home</a>
        <a href="../pages/services.html">Services</a>
        <a href="#" id="footerAccountLink">Placeholder</a>
        <a href="#">Placeholder</a>
      </div>

      <div class="footer-contact">
        <p>üìç E. Locson Drive, Talon-talon, Zamboanga City</p>
        <p>üìû - - - - - </p>
        <p>üìß linesprintingservices@gmail.com</p>
      </div>
    </div>

    <div class="footer-bottom">
      <p>&copy; 2025 Lines Printing Services. All rights reserved.</p>
    </div>
  </footer>

  <script src="../js-files/modals.js"></script>
  <script type="module" src="../js-files/services.js?v=2"></script>
  <script>
    // Check login status and update navigation
    function updateNavigation() {
      const userLoggedIn = sessionStorage.getItem('userLoggedIn');
      const username = sessionStorage.getItem('username') || 'User';
      
      if (userLoggedIn === 'true') {
        // User is logged in - show account elements
        document.getElementById('userIndicator').style.display = 'flex';
        document.getElementById('usernameDisplay').textContent = username;
        document.getElementById('accountBtn').style.display = 'inline-flex';
        document.getElementById('loginBtn').style.display = 'none';
        document.getElementById('ordersNavItem').style.display = 'block';
        
        // Update footer link
        const footerLink = document.getElementById('footerAccountLink');
        footerLink.textContent = 'My Account';
        footerLink.href = '../dashboard.html';
      } else {
        // User is not logged in - show login button
        document.getElementById('userIndicator').style.display = 'none';
        document.getElementById('accountBtn').style.display = 'none';
        document.getElementById('loginBtn').style.display = 'block';
        document.getElementById('ordersNavItem').style.display = 'none';
        
        // Update footer link
        const footerLink = document.getElementById('footerAccountLink');
        footerLink.textContent = 'Login';
        footerLink.href = './login.html';
      }
    }

    // Initialize navigation on page load
    updateNavigation();
    
    // Show notification bell if logged in
    const isLoggedIn = sessionStorage.getItem('userLoggedIn');
    if (isLoggedIn === 'true') {
      const bell = document.getElementById('notificationBell');
      if (bell) {
        bell.style.display = 'block';
      }
    }

    // Load notifications directly for services page
    async function loadNotificationsForServices() {
      const userEmail = sessionStorage.getItem('userEmail');
      const isLoggedIn = sessionStorage.getItem('userLoggedIn');
      
      if (!isLoggedIn || !userEmail) return;
      
      try {
        const { getFirestore, collection, query, where, onSnapshot } = await import("https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js");
        const { initializeApp, getApps } = await import("https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js");
        
        // Initialize Firebase if not already done
        let db;
        if (getApps().length === 0) {
          const firebaseConfig = {
            apiKey: "AIzaSyAao4TBFvMR099d5sEfvX1I65d0LCAJUZw",
            authDomain: "lineshub-98e0f.firebaseapp.com",
            projectId: "lineshub-98e0f",
            storageBucket: "lineshub-98e0f.appspot.com",
            messagingSenderId: "427905073524",
            appId: "1:427905073524:web:95cb66ffeabf011087ec21"
          };
          const app = initializeApp(firebaseConfig);
          db = getFirestore(app);
        } else {
          db = getFirestore();
        }
        
        // Query notifications
        const notificationsRef = collection(db, 'notifications');
        const q = query(notificationsRef, where('userEmail', '==', userEmail));
        
        onSnapshot(q, (snapshot) => {
          const notifications = [];
          snapshot.forEach((doc) => {
            notifications.push({ id: doc.id, ...doc.data() });
          });
          
          // Sort by timestamp
          notifications.sort((a, b) => {
            const timeA = a.timestamp?.toMillis ? a.timestamp.toMillis() : 0;
            const timeB = b.timestamp?.toMillis ? b.timestamp.toMillis() : 0;
            return timeB - timeA;
          });
          
          updateNotificationDropdown(notifications);
        });
      } catch (error) {
        console.error('Error loading notifications:', error);
      }
    }
    
    function updateNotificationDropdown(notifications) {
      const badge = document.getElementById('notificationBadge');
      const dropdownList = document.getElementById('notificationDropdownList');
      
      const unreadCount = notifications.filter(n => !n.read).length;
      
      if (badge) {
        if (unreadCount > 0) {
          badge.textContent = unreadCount > 99 ? '99+' : unreadCount;
          badge.style.display = 'block';
        } else {
          badge.style.display = 'none';
        }
      }
      
      if (dropdownList) {
        if (notifications.length === 0) {
          dropdownList.innerHTML = `
            <div class="notification-empty">
              <i class="fas fa-bell-slash"></i>
              <p>No notifications yet</p>
            </div>
          `;
        } else {
          dropdownList.innerHTML = notifications.slice(0, 5).map(notif => {
            const timeAgo = formatNotificationTime(notif.timestamp);
            const icon = getNotificationIcon(notif.type);
            return `
              <div class="notification-dropdown-item ${notif.read ? '' : 'unread'}" onclick="handleNotificationClick('${notif.id}', '${notif.orderId}')">
                <div class="notification-icon ${notif.type}">
                  <i class="fas ${icon}"></i>
                </div>
                <div class="notification-content">
                  <div class="notification-title">${notif.title}</div>
                  <div class="notification-message">${notif.message}</div>
                  <div class="notification-time">${timeAgo}</div>
                </div>
              </div>
            `;
          }).join('');
        }
      }
    }
    
    function getNotificationIcon(type) {
      switch (type) {
        case 'status-update':
          return 'fa-sync-alt';
        case 'message':
          return 'fa-comment';
        case 'order-complete':
          return 'fa-check-circle';
        default:
          return 'fa-bell';
      }
    }
    
    function formatNotificationTime(timestamp) {
      if (!timestamp) return 'Just now';
      const date = timestamp?.toDate ? timestamp.toDate() : new Date(timestamp);
      if (isNaN(date.getTime())) return 'Recently';
      
      const now = new Date();
      const diff = Math.floor((now - date) / 1000);
      
      if (diff < 60) return 'Just now';
      if (diff < 3600) return `${Math.floor(diff / 60)}m ago`;
      if (diff < 86400) return `${Math.floor(diff / 3600)}h ago`;
      if (diff < 604800) return `${Math.floor(diff / 86400)}d ago`;
      return date.toLocaleDateString();
    }
    
    // Define notification functions
    window.toggleNotificationDropdown = function() {
      const dropdown = document.getElementById('notificationDropdown');
      if (dropdown) {
        dropdown.classList.toggle('active');
      }
    };

    window.markAllNotificationsRead = async function() {
      const userEmail = sessionStorage.getItem('userEmail');
      if (!userEmail) return;
      
      try {
        const { getFirestore, collection, query, where, getDocs, updateDoc, doc } = await import("https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js");
        const db = getFirestore();
        
        const notificationsRef = collection(db, 'notifications');
        const q = query(notificationsRef, where('userEmail', '==', userEmail), where('read', '==', false));
        const snapshot = await getDocs(q);
        
        const updates = [];
        snapshot.forEach((docSnap) => {
          updates.push(updateDoc(doc(db, 'notifications', docSnap.id), { read: true }));
        });
        
        await Promise.all(updates);
        
        const dropdown = document.getElementById('notificationDropdown');
        if (dropdown) {
          dropdown.classList.remove('active');
        }
      } catch (error) {
        console.error('Error marking all as read:', error);
      }
    };
    
    window.handleNotificationClick = async function(notificationId, orderId) {
      try {
        const { getFirestore, updateDoc, doc } = await import("https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js");
        const db = getFirestore();
        await updateDoc(doc(db, 'notifications', notificationId), { read: true });
      } catch (error) {
        console.error('Error marking as read:', error);
      }
      window.location.href = `../user.html?orderId=${orderId}`;
    };
    
    // Initialize notifications
    if (sessionStorage.getItem('userLoggedIn') === 'true') {
      loadNotificationsForServices();
    }

    // Scroll to services section
    function scrollToServices() {
      const servicesSection = document.getElementById('services-cards');
      if (servicesSection) {
        servicesSection.scrollIntoView({ behavior: 'smooth' });
      }
    }
    window.scrollToServices = scrollToServices;

    // Import and initialize services module functions
    // Wait for the module to load before making functions available
    let servicesModuleLoaded = false;
    
    // Temporary placeholder functions that wait for module to load
    window.openModal = function(service) {
      if (servicesModuleLoaded && window._openModal) {
        window._openModal(service);
      } else {
        console.log('Waiting for services module to load...');
        setTimeout(() => window.openModal(service), 100);
      }
    };
    
    window.closeModal = function() {
      if (servicesModuleLoaded && window._closeModal) {
        window._closeModal();
      } else {
        const modalOverlay = document.getElementById('modalOverlay');
        if (modalOverlay) {
          modalOverlay.classList.remove('active');
          document.body.style.overflow = 'auto';
        }
      }
    };
    
    window.closeModalOnOverlay = function(event) {
      if (event.target.id === 'modalOverlay') {
        window.closeModal();
      }
    };
    
    window.selectPayment = function(method, el) {
      if (servicesModuleLoaded && window._selectPayment) {
        window._selectPayment(method, el);
      } else {
        window.selectedPayment = method;
        const pm = document.getElementById('paymentMethod');
        if (pm) pm.value = method;

        document.querySelectorAll('.payment-option').forEach(option => {
          option.classList.remove('selected');
        });
        if (el && el.classList) el.classList.add('selected');
      }
    };
    
    window.handleSubmit = function(event) {
      event.preventDefault();
      if (servicesModuleLoaded && window._handleSubmit) {
        window._handleSubmit(event);
      }
    };
    
    // Search suggestions data
    const searchData = [
      { name: 'Document Printing', icon: 'fas fa-file-alt', action: () => openModal('document'), category: 'Printing' },
      { name: 'Photo Printing', icon: 'fas fa-image', action: () => openModal('photo'), category: 'Printing' },
      { name: 'Shirt Printing', icon: 'fas fa-tshirt', action: () => openShirtDesignerChoice(), category: 'Printing' },
      { name: 'T-Shirt Designer', icon: 'fas fa-tshirt', action: () => openShirtDesignerChoice(), category: 'Design' },
      { name: 'Tarpaulin Printing', icon: 'fas fa-rectangle-ad', action: () => openModal('tarpaulin'), category: 'Printing' },
      { name: 'Stickers', icon: 'fas fa-sticky-note', action: () => openModal('stickers'), category: 'Printing' },
      { name: 'Customized Items', icon: 'fas fa-magic', action: () => openModal('customized'), category: 'Custom' },
      { name: 'Signages', icon: 'fas fa-sign', action: null, category: 'Coming Soon' },
      { name: 'Gift Boxes', icon: 'fas fa-gift', action: null, category: 'Coming Soon' },
      { name: 'Lanyards', icon: 'fas fa-id-badge', action: null, category: 'Coming Soon' },
      { name: 'Invitations', icon: 'fas fa-envelope', action: null, category: 'Coming Soon' }
    ];

    window.showSearchSuggestions = function(event) {
      const query = event.target.value.toLowerCase().trim();
      const suggestionsContainer = document.getElementById('searchSuggestions');
      
      if (!query) {
        suggestionsContainer.classList.remove('active');
        return;
      }

      // Filter suggestions
      const matches = searchData.filter(item => 
        item.name.toLowerCase().includes(query) ||
        item.category.toLowerCase().includes(query)
      );

      if (matches.length === 0) {
        suggestionsContainer.innerHTML = '<div class="suggestion-item" style="cursor: default;"><i class="fas fa-search"></i><span class="suggestion-text">No results found</span></div>';
        suggestionsContainer.classList.add('active');
        return;
      }

      // Display suggestions
      suggestionsContainer.innerHTML = matches.map(item => `
        <div class="suggestion-item" onclick="selectSuggestion('${item.name}')">
          <i class="${item.icon}"></i>
          <span class="suggestion-text">${item.name}</span>
          <span class="suggestion-category">${item.category}</span>
        </div>
      `).join('');
      
      suggestionsContainer.classList.add('active');
    };

    window.selectSuggestion = function(serviceName) {
      const service = searchData.find(s => s.name === serviceName);
      if (service && service.action) {
        service.action();
      } else {
        alert(`${serviceName} - Coming soon!`);
      }
      
      // Clear search and hide suggestions
      document.getElementById('search-input').value = '';
      document.getElementById('searchSuggestions').classList.remove('active');
    };

    // Close suggestions when clicking outside
    document.addEventListener('click', function(event) {
      const searchWrapper = document.querySelector('.search-wrapper');
      if (searchWrapper && !searchWrapper.contains(event.target)) {
        document.getElementById('searchSuggestions').classList.remove('active');
      }
    });

    window.handleSearch = function(event) {
      event.preventDefault();
      const searchInput = document.getElementById('search-input').value.trim();
      if (searchInput) {
        // Try to find exact match
        const match = searchData.find(s => 
          s.name.toLowerCase() === searchInput.toLowerCase()
        );
        if (match && match.action) {
          match.action();
        } else {
          alert(`No exact match found for "${searchInput}"`);
        }
      }
    };
    
    // Listen for module loaded event
    window.addEventListener('servicesModuleReady', () => {
      servicesModuleLoaded = true;
      console.log('Services module loaded and ready');
    });

    // 3D Designer Integration Functions
    function openShirtDesignerChoice() {
      const modal = document.getElementById('shirtChoiceModal');
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function closeChoiceModal() {
      const modal = document.getElementById('shirtChoiceModal');
      modal.classList.remove('active');
      document.body.style.overflow = 'auto';
    }

    function closeChoiceModalOnOverlay(event) {
      if (event.target.id === 'shirtChoiceModal') {
        closeChoiceModal();
      }
    }

    function open3DDesigner() {
      closeChoiceModal();
      
      const modal = document.getElementById('designer3DModal');
      const iframe = document.getElementById('designerIframe');
      
      iframe.src = './tshirt-designer-3d.html';
      
      modal.classList.add('active');
      document.body.style.overflow = 'hidden';
    }

    function close3DDesigner() {
      const modal = document.getElementById('designer3DModal');
      const iframe = document.getElementById('designerIframe');
      
      modal.classList.remove('active');
      iframe.src = 'about:blank';
      document.body.style.overflow = 'auto';
    }

    function openQuickDesigner() {
      closeChoiceModal();
      if (typeof openModal === 'function') {
        openModal('shirt');
      }
    }

    // Listen for messages from 3D designer
    window.addEventListener('message', (event) => {
      const { type, data } = event.data;
      
      switch (type) {
        case 'DESIGN_SAVED':
          console.log('Design saved from 3D designer:', data);
          showNotification('‚úÖ Design saved successfully!', 'success');
          
          if (confirm('Design saved! Would you like to proceed with your order?')) {
            close3DDesigner();
            setTimeout(() => {
              openModal('shirt');
              setTimeout(() => {
                const notesField = document.getElementById('shirtNotes');
                if (notesField) {
                  notesField.value = `3D Design Created - Order ID: ${data.orderId}\nShirt Color: ${data.shirtColor}`;
                }
              }, 300);
            }, 500);
          }
          break;
          
        case 'DESIGN_EXPORTED':
          console.log('Design exported from 3D designer:', data);
          showNotification('‚úÖ Design exported successfully!', 'success');
          break;
          
        case 'DESIGNER_CLOSED':
          close3DDesigner();
          break;
      }
    });

    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 1rem 1.5rem;
        background: ${type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#3b82f6'};
        color: white;
        border-radius: 8px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        z-index: 10001;
        font-weight: 600;
        animation: slideIn 0.3s ease;
      `;
      notification.textContent = message;

      const style = document.createElement('style');
      style.textContent = `
        @keyframes slideIn {
          from {
            transform: translateX(400px);
            opacity: 0;
          }
          to {
            transform: translateX(0);
            opacity: 1;
          }
        }
      `;
      document.head.appendChild(style);

      document.body.appendChild(notification);

      setTimeout(() => {
        notification.style.animation = 'slideIn 0.3s ease reverse';
        setTimeout(() => {
          if (notification.parentNode) {
            document.body.removeChild(notification);
          }
        }, 300);
      }, 3000);
    }

    // Make functions globally accessible
    window.openShirtDesignerChoice = openShirtDesignerChoice;
    window.closeChoiceModal = closeChoiceModal;
    window.closeChoiceModalOnOverlay = closeChoiceModalOnOverlay;
    window.open3DDesigner = open3DDesigner;
    window.close3DDesigner = close3DDesigner;
    window.openQuickDesigner = openQuickDesigner;

    // Close 3D designer on ESC key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape') {
        const designer3DModal = document.getElementById('designer3DModal');
        const choiceModal = document.getElementById('shirtChoiceModal');
        
        if (designer3DModal && designer3DModal.classList.contains('active')) {
          close3DDesigner();
        } else if (choiceModal && choiceModal.classList.contains('active')) {
          closeChoiceModal();
        }
      }
    });
  </script>
</body>
</html>
<s
cript type="module" src="../js-files/notifications.js"></script>
